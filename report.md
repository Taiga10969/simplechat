# ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆï¼šAIã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°å®Ÿè·µè¬›åº§2025 ç¬¬2å› å®¿é¡Œ

ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã§ã¯ï¼Œã€AIã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°å®Ÿè·µè¬›åº§2025ã€‘ç¬¬2å›ã®å®¿é¡Œï¼ˆæ¼”ç¿’èª²é¡Œï¼‰ã®å®Ÿæ–½å†…å®¹ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ï¼<br>
ç¬¬2å›ã®å®¿é¡Œã§ã¯ï¼ŒAWSã‹ã‚‰FastAPIã§ç«‹ã¦ãŸLLMã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å›ç­”ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ï¼<br>
ã“ã“ã§ã¯ï¼ŒAWSä¸Šã§å¤‰æ›´ã‚’åŠ ãˆãŸç‚¹ã«ã¤ã„ã¦ã¾ã¨ã‚ãŸï¼<br>

## ğŸ™‹ åŸºæœ¬æƒ…å ±

- **Omnicampus ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå**ï¼š`taiga10969`  
- **åå‰**ï¼šå¢—ç”°å¤§æ²³
--- 

### [2] è¬›ç¾©å†…ã®æ¼”ç¿’ã®å®Ÿæ–½
UIã‚’æ”¹è‰¯ã—ï¼Œ`MODEL_ID:us.amazon.nova-lite-v1:0`ã‚’å®Ÿè¡Œã—ãŸã¨ãã®çµæœã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ï¼<br>
ã¾ãŸï¼Œ`MODEL_ID:us.amazon.nova-micro-v1:0`ã‚‚å®Ÿè¡Œã—å‹•ä½œã‚’ç¢ºèªã—ãŸï¼<br>
â–¼å®Ÿè¡Œçµæœ

<img src="https://github.com/Taiga10969/simplechat/blob/main/report/%E7%94%BB%E9%9D%A2%E5%8F%8E%E9%8C%B2%202025-04-25%2016.56.59.gif" alt="" width="500" />

### [3] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¿®æ­£ã«ã‚ˆã‚‹ç‹¬è‡ªãƒ¢ãƒ‡ãƒ«ã®åˆ©ç”¨

ä½¿ç”¨ã—ãŸãƒ¢ãƒ‡ãƒ«ï¼š`elyza/ELYZA-japanese-CodeLlama-7b-instruct`<br>
7bã‚‚ã®å¤§ãã•ã®ãƒ¢ãƒ‡ãƒ«ã‚’Google Colaboratoryï¼ˆç„¡æ–™æ ï¼‰ã§ã‚‚å‹•ä½œã•ã›ã‚‹ãŸã‚ã«ã¯ï¼Œé‡å­åŒ–ã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å·¥å¤«ã‚’ã—ã¦ã„ã‚‹ï¼<br>
è©³ã—ãã¯ï¼Œ[ã“ã“](https://github.com/Taiga10969/lecture-ai-engineering/blob/master/day1/03_FastAPI/README.md) ã«è¨˜è¼‰ã—ã¦ã‚ã‚Šã¾ã™ï¼<br>

ã“ã®ç‹¬è‡ªãƒ¢ãƒ‡ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ï¼Œ`./lambda/index.py`ã‚’FastAPIã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ãŸï¼å¤‰æ›´ç‚¹ã‚’æœ€å¾Œã«ç¤ºã™ï¼<br>
â–¼å®Ÿè¡Œçµæœ

<img src="https://github.com/Taiga10969/simplechat/blob/main/report/%E7%94%BB%E9%9D%A2%E5%8F%8E%E9%8C%B2-2025-04-26-23.22.17.gif" alt="" width="500" />

â–¼`elyza/ELYZA-japanese-CodeLlama-7b-instruct`ãŒç”Ÿæˆã—ãŸmatplotlibã®ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œçµæœ

<img src="https://github.com/Taiga10969/simplechat/blob/main/report/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202025-04-26%2023.27.50.png" alt="" width="500" />

### [+Î±] UIã®æ”¹å–„
1. `Enter` ã‚’æŠ¼ã™ã¨å¤‰æ›ã®ç¢ºå®šã«ã‚‚é–¢ã‚ã‚‰ãšãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ã‚‰ã‚Œã¦ã—ã¾ã†å•é¡Œã‚’è§£æ±º (APP.js)
   <br>
    ```
    <form onSubmit={handleSubmit} className="input-form">
      <textarea
        value={input}
        onChange={(e) => setInput(e.target.value)}
        placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..."
        disabled={loading}
        onKeyDown={(e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            //handleSubmit(e);
          }
        }}
      />
      <button type="submit" disabled={loading || !input.trim()}>
        ğŸ¯é€ä¿¡
      </button>
    </form>
    ```
2. `CSS`ã®æ”¹å–„
   CSSã‚’é©å®œå¤‰æ›´ã—ï¼ŒğŸ¯ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆè‡ªåˆ†ã®åå‰Taigaã‹ã‚‰æ¥ã¦ã„ã‚‹ç¬‘ï¼‰ã«å¤‰æ›´ã—ã¾ã—ãŸï¼

---

### è£œè¶³è³‡æ–™ (`./lambda/index.py`ã®å¤‰æ›´ç‚¹ï¼‰
```
MODEL_API_URL = os.environ.get("MODEL_API_URL", "https://c7a2-34-138-10-164.ngrok-free.app/generate")

def lambda_handler(event, context):
    try:
        print("Received event:", json.dumps(event))

        user_info = None
        if 'requestContext' in event and 'authorizer' in event['requestContext']:
            user_info = event['requestContext']['authorizer']['claims']
            print(f"Authenticated user: {user_info.get('email') or user_info.get('cognito:username')}")

        body = json.loads(event['body'])
        message = body['message']
        conversation_history = body.get('conversationHistory', [])
        print("User message:", message)

        prompt = ""
        for msg in conversation_history:
            role = msg["role"]
            content = msg["content"]
            if role == "user":
                prompt += f"ãƒ¦ãƒ¼ã‚¶ãƒ¼: {content}\n"
            elif role == "assistant":
                prompt += f"ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ: {content}\n"
        prompt += f"ãƒ¦ãƒ¼ã‚¶ãƒ¼: {message}\nã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ:"

        payload = {
            "prompt": prompt,
            "max_new_tokens": 100,
            "do_sample": True,
            "temperature": 0.7,
            "top_p": 0.9
        }

        print("Sending request to custom model API")
        data = json.dumps(payload).encode("utf-8")
        req = urllib.request.Request(MODEL_API_URL, data=data, method="POST")
        req.add_header("Content-Type", "application/json")
        req.add_header("Accept", "application/json")

        try:
            with urllib.request.urlopen(req) as res:
                response_data = json.loads(res.read().decode("utf-8"))
        except HTTPError as e:
            raise Exception(f"Model API error: {e.code}, {e.read().decode('utf-8')}")
        except URLError as e:
            raise Exception(f"Failed to reach server: {e.reason}")

        assistant_response = response_data["generated_text"]

        conversation_history.append({"role": "user", "content": message})
        conversation_history.append({"role": "assistant", "content": assistant_response})

        return {
            "statusCode": 200,
            "headers": {
                "Content-Type": "application/json",
                "Access-Control-Allow-Origin": "*",
                "Access-Control-Allow-Headers": "Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token",
                "Access-Control-Allow-Methods": "OPTIONS,POST"
            },
            "body": json.dumps({
                "success": True,
                "response": assistant_response,
                "conversationHistory": conversation_history
            })
        }

    except Exception as error:
        print("Error:", str(error))
        return {
            "statusCode": 500,
            "headers": {
                "Content-Type": "application/json",
                "Access-Control-Allow-Origin": "*",
                "Access-Control-Allow-Headers": "Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token",
                "Access-Control-Allow-Methods": "OPTIONS,POST"
            },
            "body": json.dumps({
                "success": False,
                "error": str(error)
            })
        }
```

